var IndexPage={tasks:[],init:function(){User.loadUser(),User.authorized||window.location.replace(window.location.protocol+"//"+window.location.host+"/sign_in.html"),this.loadTasks(),this.taskInput=document.getElementById("task-name"),document.getElementById("add-task-btn").addEventListener("click",this.sendCreateRequest.bind(this))},loadTasks:function(){var e=function(e){this.tasks=e};$.ajax({url:"http://spalah-home.herokuapp.com/tasks.json",method:"GET",headers:User.accessHeaders,success:User.refreshTokenAndRunCallback(e.bind(this))})},sendCreateRequest:function(e){e.preventDefault();var s=User.accessHeaders;s["Content-Type"]="application/json";var t=function(e){this.tasks.push({name:this.taskInput.value})};$.ajax({url:"http://spalah-home.herokuapp.com/tasks.json",method:"POST",headers:s,data:JSON.stringify({name:this.taskInput.value}),success:User.refreshTokenAndRunCallback(t.bind(this))})}};
var SignIn={init:function(){this.initEvents(),this.checkAuthorization()},initEvents:function(){null!=document.getElementById("signInForm")&&document.getElementById("signInForm").addEventListener("submit",this.signInForm.bind(this))},signInForm:function(){event.preventDefault();var o=document.getElementById("exampleInputEmail2").value,t=document.getElementById("exampleInputPassword2").value,e={email:o,password:t};this.authorizationUser(e)},authorizationUser:function(o){$.ajax({type:"POST",url:"http://spalah-home.herokuapp.com/auth/sign_in.json",contentType:"application/json; charset=utf-8",data:JSON.stringify(o),success:function(o,t,e){localStorage.setItem("Access-Token",e.getResponseHeader("Access-Token")),localStorage.setItem("Client",e.getResponseHeader("Client")),localStorage.setItem("Token-Type",e.getResponseHeader("Token-Type")),localStorage.setItem("Uid",e.getResponseHeader("Uid")),window.location.replace(window.location.protocol+"//"+window.location.host+"/index.html")},error:function(o,t,e){}})},checkAuthorization:function(){var o=window.location.protocol+"//"+window.location.host+"/"+window.location.pathname;o===window.location.protocol+"//"+window.location.host+"/index.html"?localStorage.getItem("Access-Token")&&localStorage.getItem("Client")&&localStorage.getItem("Token-Type")&&localStorage.getItem("Uid")||window.location.replace(window.location.protocol+"//"+window.location.host+"/sign_in.html"):o===window.location.protocol+"//"+window.location.host+"/sign_in.html"&&localStorage.getItem("Access-Token")&&localStorage.getItem("Client")&&localStorage.getItem("Token-Type")&&localStorage.getItem("Uid")&&window.location.replace(window.location.protocol+"//"+window.location.host+"/index.html")}};
var SignUp={init:function(){User.loadUser();var e=location.host;User.authorized&&window.location.replace(e),this.emailInput=document.getElementById("exampleInputEmail1"),this.passInput=document.getElementById("exampleInputPassword1"),this.passConfirmInput=document.getElementById("exampleInputPassword2"),this.initEvents()},initEvents:function(){document.getElementById("submitBtn").addEventListener("click",this.signUpUser.bind(this))},signUpUser:function(){event.preventDefault();var e={email:this.emailInput.value,password:this.passInput.value,password_confirmation:this.passConfirmInput.value};for(var t in e)document.getElementById(t).classList.remove("has-error");$.ajax({url:"http://spalah-home.herokuapp.com/auth.json",method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(e),success:function(e,t,n){var s={"Access-Token":n.getResponseHeader("Access-Token"),Client:n.getResponseHeader("Client"),Uid:n.getResponseHeader("Uid"),"Token-Type":n.getResponseHeader("Token-Type")};User.authorize(e,s)}})}};
var User={authorize:function(e,s){this.userData=e,this.accessHeaders=s,this.authorized=!0,this.saveAccessHeaders(s)},loadUser:function(){var e=localStorage.getItem("accessHeaders");e?(this.accessHeaders=JSON.parse(e),this.authorized=!0):this.authorized=!1},saveAccessHeaders:function(e){localStorage.setItem("accessHeaders",JSON.stringify(e))},updateAccessToken:function(e){if(e){var s=JSON.parse(localStorage.getItem("accessHeaders"));s["Access-Token"]=e,this.accessHeaders=s,this.saveAccessHeaders(s)}},refreshTokenAndRunCallback:function(e){var s=this;return function(a,c,t){s.updateAccessToken(t.getResponseHeader("Access-Token")),e(a,c,t)}}};